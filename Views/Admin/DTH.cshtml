@{
    ViewData["Title"] = "DTH";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<style>

    /* check box */

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }

    h6.namegg i {
        transform: rotate(-88deg);
        margin: 1px 10px;
        /* padding-top: 17px; */
        /* padding-left: 0; */
    }

    .ssarow {
        transform: rotate(88deg);
        margin: 1px 10px;
        /* padding-top: 17px; */
        /* padding-left: 0; */
    }


    /*  End check box */


    .q3 {
        border: 1px solid #b8cdeb;
        background: linear-gradient(3deg, white, #ffffff);
        height: 200px;
        /*background: white;*/
    }


    body {
        padding: 10px;
    }

    #exTab1 .tab-content {
        color: white;
        background-color: #428bca;
        padding: 5px 15px;
    }

    #exTab2 h3 {
        color: white;
        background-color: #428bca;
        padding: 5px 15px;
    }

    /* remove border radius for the tab */

    #exTab1 .nav-pills > li > a {
        border-radius: 0;
    }

    /* change border radius for the tab , apply corners on top*/

    #exTab3 .nav-pills > li > a {
        border-radius: 4px 4px 0 0;
    }

    #exTab3 .tab-content {
        color: white;
        background-color: #428bca;
        padding: 5px 15px;
    }

    ul#myTab {
        display: flex;
        width: 100%;
    }

    .tab-pane {
        padding: 18px;
    }

    nav#myTab {
        display: block !important;
    }

    .tab-content {
        width: 100%;
        background: #fff;
    }


    .card-header > * {
        margin-left: -50px;
        margin-right: 8px;
    }
</style>



@using System.Data
@model DataTable

<div class="row">
    <div class="col-12 ">
        <div class="box q1 bg-gradient-primary overflow-hidden pull-up">
            <div class="box-body pr-0 pl-lg-50 pl-15 py-0">
                <div class="row align-items-center">
                    <div class="col-12 col-lg-12">
                        <h1 class="new-title"> DTH </h1>
                        <p class="text-white mb-0 font-size-20">
                        </p>
                    </div>
                    @*  <div class="col-12 col-lg-4"><img src="https://eduadmin-template.multipurposethemes.com/bs4/images/svg-icon/color-svg/custom-15.svg" alt="" class="JKK"></div>*@
                </div>
            </div>
        </div>
    </div>
</div>


<nav class="navbar navbar-expand-lg navbar-light bg-light" id="myTab" role="tablist">


    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#demo" type="button" role="tab" aria-controls="home" aria-selected="true">DTH INFO</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#demo1" type="button" role="tab" aria-controls="profile" aria-selected="false">DTH RECHARGE</button>
        </li>
        <li class="nav-item" role="presentation">

            @* <a href="/admin/CheckPanStatus">
            <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#demo2" type="button" role="tab" aria-controls="contact" aria-selected="false">Check status</button>
            </a>*@

        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="demo" role="tabpanel" aria-labelledby="home-tab">








            <section class="content" id="Dthinfo">
                <div class="">

                    <div class="">

                        <div class="">

                            <div class="">
                                <div class="">
                                    <h3 class="card-title new-title">DTH INFO</h3>
                                </div>

                                <div class="card-body ">

                                    <div class="row">



                                        <div class="col-sm-4">

                                            <div class="form-group">
                                                <label>Mobile Number <span style="color:red">*</span></label>
                                                <input type="text" class="form-control" placeholder="Enter Mobile Number" maxlength="10" id="txtPhone1" onkeypress="return numeric(event);" onchange="phonenumberlength();" />

                                            </div>
                                        </div>


                                        <div class="col-sm-4">
                                            <label>Operator:</label>

                                            <select class="form-control" id="Pipe" required name="Pipe">
                                                <option value="0" disabled selected>-- Select Operator --</option>
                                                @*<option value="TataSky" id="TataSky">Tata Sky</option>
                                                <option value="Airtel" id="Airtel"> Airtel</option>

                                                <option value="DishTv" id="DishTv"> DishTv </option>*@
                                                @if (Model != null && Model.Rows.Count > 0)
                                                {
                                                    foreach (DataRow dr in Model.Rows)
                                                    {

                                                        if (@dr["category"].ToString() == "DTH")
                                                        {
                                                            <option value="@dr["name"]" idval="@dr["id"]"> @dr["name"] </option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>

                                        <div class="col-md-4">
                                            <button type="button" id="btnSearch" class="btn btn-primary btn-block waves-effect waves-light" onclick="QueryDTHINFOcheck()">Search</button>
                                        </div>
                                    </div>

                                    <div id="infotbl"></div>



                                </div>

                            </div>
                        </div>
                    </div>

                </div>

            </section>



        </div>

        <div class="tab-pane fade" id="demo1" role="tabpanel" aria-labelledby="profile-tab">








            <section class="content">
                <div class="">

                    <div class="">

                        <div class="">

                            <div class="">
                                <div class="">
                                    <h3 class="card-title new-title">DTH Recharge</h3>
                                </div>

                                <div class="card-body ">
                                    <!-- brows Plan start -->

                                    <div class="row">


                                        <div class="col-sm-6">

                                            <div class="form-group">
                                                <label>Phone No:	 </label>
                                                <input type="text" class="form-control" placeholder="Enter Phone No" maxlength="10" id="txtPhone1rech" onkeypress="return numeric(event);" />

                                            </div>
                                        </div>

                                        <div class="col-sm-6" >
                                            <label>Circle:</label>

                                            <select class="form-control" id="ddlcircle" onchange="QueryDTHRechargecheckBrowsPlan()" required name="Pipe">
                                                <option value="0" disabled selected>-- Select Circle --</option>
                                                @foreach (DataRow dr in ViewBag.rechargeplan.Rows)
                                                {
                                                    <option value="@dr["name"]"> @dr["name"] </option>
                                                }
                                            </select>
                                        </div>

                                        <div class="col-sm-6">

                                            <label>   Operator:</label>
                                            <select class="form-control" onchange="QueryDTHRechargecheckBrowsPlan()" id="ddloperator" required name="Pipe">
                                                <option value="0" disabled selected>-- Select Operator --</option>
                                                @if (Model != null && Model.Rows.Count > 0)
                                                {
                                                    foreach (DataRow dr in Model.Rows)
                                                    {
                                                        
                                                        if (@dr["category"].ToString() == "DTH")
                                                        {
                                                            <option value="@dr["name"]" idval="@dr["id"]"> @dr["name"]</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>
                                        
                                    



                                       

                                        <div class="col-sm-6">
                                            <label>Plan:</label>

                                            <input type="number" class="form-control" id="ddlplan" required name="Pipe" />

                                            <p id="ddlplanmsg"></p>
                                        </div>
                                    </div>
                                    <button type="button" id="btnSearch" class="btn btn-primary waves-effect waves-light" onclick="QueryDTHRechargecheck()">Do Recharge </button>
                                    <br />
                                    <div id="tblplandv" class="col-sm-12">
                                    </div>



                                </div>

                            </div>
                        </div>
                    </div>

                </div>

            </section>





        </div>




    </div>



</nav>


<script>

    function QueryDTHRechargecheckBrowsPlan() {
        if ($("#ddlcircle").val() == "0" || $("#ddlcircle").val() == '' || $("#ddlcircle").val() == null) {
            return;
        }
        var data = new FormData;

        data.append("circle", $("#ddlcircle").val());
        data.append("op", $("#ddloperator").val());


        $("#showSpinner").show();

        $.ajax({
            url: "/Admin/DTHBrjowsPlan",
            type: "POST",
            contentType: false,
            processData: false,
            data: data,
            success: function (r) {
                debugger;
                console.log('plan')
                //console.log(r)
                var dt = jQuery.parseJSON(r)
                console.log(dt)
                $("#ddlplanmsg").html('')
                var tbl = ""

                if (dt.response_code == "1") {
                    var allplan = dt.info;
                    if (allplan[0].status=='0')
                    {
                        tbl = '<h3 style="text-align:center;">' + allplan[0].desc + '</h3>'
                    }
                    else
                    {
                    var topup = allplan.TOPUP
                   
                        for(var item of topup) {

                        tbl += "<table  class='table table-responsive table-striped table-bordered' width = '100%' > <thead><tr><td>₹</td><td>Validity</td> <td>description </td></tr> </thead>   <tbody> <tr><td>" + item.rs + "  < /td><td>" + item.validity + "</td> <td>" + item.desc + " </td></tr> </tbody>  </table>"
                    }
                    }
                }
                else {
                    tbl += dt.message;
                }
                $("#tblplandv").html(tbl)


               
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Please Check values Entered by you !!!');
                $("#showSpinner").hide();
            }


        });
    }

</script>


<script type="text/javascript" language="javascript">

    $(document).ready(function () {
        //
        // BrowsPlan();

        //$("#txtPhone1rech").keyup(function () {
        //    debugger;
        //    if ($("#txtPhone1rech").length == 10) {
        //        $.post("/Admin/CheckHLR", { number: $("#txtPhone1rech").val(), type: "dth" } function (data) {
        //        alert(data)
        //    });
        //    }
        //});



    });

    function numeric(e) {
        var unicode = e.charCode ? e.charCode : e.keyCode;
        if (unicode == 8 || unicode == 9 || (unicode >= 48 && unicode <= 57)) {
            return true;
        }
        else {
            return false;
        }
    }







    //function QueryDTHRechargecheck() {

    //    if ($('#txtPhone1rech').val() == "") {
    //        alert('Enter Phone No.');
    //        $('#txtPhone1rech').focus();
    //        return;
    //    }


    //    var data = new FormData;

    //    data.append("mobile", $("#txtPhone1").val());
    //    data.append("bank3_flag", "NO");


    //    $("#showSpinner").show();

    //    $.ajax({
    //        url: "/Admin/QueryDTHINFOPost",
    //        type: "POST",
    //        contentType: false,
    //        processData: false,
    //        data: data,
    //        success: function (r) {
    //            if (r.strId == "1") {

    //            }
    //            else if (r.strId == "2") {

    //                $("#showSpinner").hide();
    //                window.location.href = "../Admin/RegisterRemmiter?Mobile=" + $("#txtPhone1").val() + "&stateresp=" + r.stateresp;
    //            }
    //            else if (r.strId == "0") {
    //                alert(r.msg);
    //                $("#showSpinner").hide();
    //            }
    //            else {
    //                alert('Server not Responding !!!');
    //                $("#showSpinner").hide();
    //            }
    //        },
    //        error: function (XMLHttpRequest, textStatus, errorThrown) {
    //            alert('Please Check values Entered by you !!!');
    //            $("#showSpinner").hide();
    //        }


    //    });
    //}





    function QueryDTHRechargecheck() {

        if ($('#txtPhone1rech').val() == "") {
            alert('Enter Phone No.');
            $('#txtPhone1rech').focus();
            return;
        }


        var data = new FormData;

        data.append("amount", $("#ddlplan").val());
        data.append("operator", $("#ddloperator :selected").attr("idval"));
        data.append("canumber", $("#txtPhone1rech").val());
        //alert($("#ddloperator :selected").attr("idval"))


        $("#showSpinner").show();

        $.ajax({
            url: "/Admin/DoMobileRecharge",
            type: "POST",
            contentType: false,
            processData: false,
            data: data,
            success: function (r) {
                if (r != null) {
                    // console.log(r)
                    alert(r.message)
                    if (r.response_code == "1")
                        location.reload();
                }
                else {
                    alert('Server not Responding !!!');
                    $("#showSpinner").hide();
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Please Check values Entered by you !!!');
                $("#showSpinner").hide();
            }



        });
    }

</script>

<script type="text/javascript" language="javascript">
    //function numeric(e) {
    //    var unicode = e.charCode ? e.charCode : e.keyCode;
    //    if (unicode == 8 || unicode == 9 || (unicode >= 48 && unicode <= 57)) {
    //        return true;
    //    }
    //    else {
    //        return false;
    //    }
    //}








    function QueryDTHINFOcheck() {

        if ($('#txtPhone1').val() == "") {
            alert('Enter Phone No.');
            $('#txtPhone1').focus();
            return;
        }


        var data = new FormData;

        data.append("canumber", $("#txtPhone1").val());
        data.append("op", $("#Pipe").val());
        //data.append("bank3_flag", "NO");


        $("#showSpinner").show();

        $.ajax({
            url: "/Admin/QueryDTHINFOPost",
            type: "POST",
            contentType: false,
            processData: false,
            data: data,
            success: function (r) {
                console.log('details')
                console.log(r)
                debugger;
                var data = jQuery.parseJSON(r)
                console.log(data)
                if (data.response_code == "1") {
                    $("#infotbl").html('')
                    if (data.info.status != "0") {
                        
                        $("#infotbl").append("<h4>" + data.message + "</h4><div class='row'><div class='col-sm-2'>Customer Name : </div><div class='col-sm-4'>" + data.info[0].customerName + "</div> <div class='col-sm-2'>Status : </div><div class='col-sm-4'>" + data.info[0].status + "</div></div>     <div class='row'><div class='col-sm-2'>Balance : </div><div class='col-sm-4'>" + data.info[0].Balance + "</div> <div class='col-sm-2'>NextRechargeDate:</div><div class='col-sm-4'>" + data.info[0].NextRechargeDate + "</div></div>                <div class='row'><div class='col-sm-2'>MonthlyRecharge : </div><div class='col-sm-4'>" + data.info[0].MonthlyRecharge + "</div> <div class='col-sm-2'>planname : </div><div class='col-sm-4'>" + data.info[0].planname + "</div></div>")
                    }
                    else {
                        $("#infotbl").append("<h4>" + data.info.desc + " </h4>")
                    }
                }
                else {
                    alert(data.message);
                    $("#showSpinner").hide();
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert('Please Check values Entered by you !!!');
                $("#showSpinner").hide();
            }


        });
    }

    //function checkHLR() {
    //    var mobnumber = $("#txtPhone1rech").val()
    //    if (mobnumber.length == 10) {

    //        $.post("/Admin/CheckHLR", { number: mobnumber, type: "dth" }, function (data) {
    //            //alert(data)
    //            debugger;
    //            //console.log(res)
    //            var res = jQuery.parseJSON(data)
    //            console.log(res)
    //            if (res.response_code == "1") {
    //                console.log(res.info)
    //                $("#ddloperator").val(res.info.operator).trigger("change")
    //                $("#ddlcircle").val(res.info.circle).trigger("change")
    //            }
    //        });

    //    }
    //}


    $(document).ready(function () {
        $('select').select2();
    });

</script>