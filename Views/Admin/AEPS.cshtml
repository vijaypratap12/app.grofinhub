@model RootAEPS;
@{
    ViewData["Title"] = "AEPS";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>


    .card {
        border-radius: 10px;
        box-shadow: 0px 2px 5px 0px rgba(19, 23, 38, 0.05);
        margin-bottom: 10px !important;
    }

    .wraperplan {
        min-width: 120px;
        max-height: 450px;
        overflow-y: scroll;
    }

    body {
        padding: 10px;
    }

    #exTab1 .tab-content {
        color: white;
        background-color: #428bca;
        padding: 5px 15px;
    }

    #exTab2 h3 {
        color: white;
        background-color: #428bca;
        padding: 5px 15px;
    }

    /* remove border radius for the tab */

    #exTab1 .nav-pills > li > a {
        border-radius: 0;
    }

    /* change border radius for the tab , apply corners on top*/

    #exTab3 .nav-pills > li > a {
        border-radius: 4px 4px 0 0;
    }

    #exTab3 .tab-content {
        color: white;
        background-color: #428bca;
        padding: 5px 15px;
    }

    ul#myTab {
        display: flex;
        width: 100%;
    }

    .tab-pane {
        padding: 18px;
    }

    nav#myTab {
        
        display: none;
    }

    .tab-content {
        width: 100%;
        background: #fff;
    }

    .yui .box {
        margin: 0 !important;
    }

    .auth-container {
        display: none;
        margin-top: 20px;
    }

    .button-container {
        margin-top: 20px;
    }

    .btn-status {
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .status-text {
        font-size: 18px;
        font-weight: bold;
        padding: 5px;
        border-radius: 5px;
    }

    .status-pending {
        color: #856404;
        background-color: #fff3cd;
        border: 1px solid #ffeeba;
    }

    .status-success {
        color: #155724;
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
    }

    .btn-success {
        background-color: #28a745;
        border: none;
    }

        .btn-success:hover {
            background-color: #218838;
        }

    .form-group {
        display: flex;
        align-items: center;
    }

    .form-label {
        width: 40%; /* Adjust the label width as needed */
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 0;
    }

    .form-group p {
        margin-left: 10px; /* Add space between label and text */
        margin-bottom: 0;
        flex-grow: 1; /* Makes the <p> tag take up remaining space */
    }

    .btn {
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
    }


   .box-header {
    color: #172b4c;
    display: block;
    padding: 0.5rem 0rem !important;
    position: relative;
    border-bottom: 1px solid rgba(72, 94, 144, 0.16);
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}

    #balanceEnquiryResponse {
        display: none; /* Initially hidden */
    }
</style>

<div class="row">
    <div class="col-12 ">
        <div class="box q1 bg-gradient-primary overflow-hidden pull-up">
            <div class="box-body pr-0 pl-lg-50 pl-15 py-0">
                <div class="row align-items-center">
                    <div class="col-12 col-lg-8">
                        <h3 class="font-size-25 text-white text-center">AEPS</h3>

                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<!--Tab-->

<div id="2FADiv" class="container text-center mt-10">
    <div class="row justify-content-start">
        <div class="col-6">
            <div class="box q1 bg-gradient-primary overflow-hidden pull-up">
                <div class="box-body pr-0 pl-lg-50 pl-15 py-0">
                    <div class="row align-items-center">
                        <div class="col-6 col-lg-10">
                            <h6 class="font-size-8 text-white text-left mt-3">AEPS 2FA Authentication</h6>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="button-container d-flex justify-content-start">
        <button id="merchantBtn" class="btn btn-primary mx-2">Merchant Registration</button>
        <button id="todayAuthBtn" class="btn btn-secondary mx-2">Today's Auth</button>
    </div>

    <!-- This div will be shown when either button is clicked -->
    <div id="authDiv" class="auth-container" style="display:none;">
        <div class="row justify-content-start">
            <div class="col-md-4">
                <div class="form-group mb-3">
                    <label for="mobileNumber" class="form-label">Mobile Number</label>
                    <p id="mobileNumber">Fetching mobile number...</p>
                </div>
                <div class="form-group mb-3">
                    <label for="aadharNumber" class="form-label">Aadhar Number</label>
                    <p id="aadharNumber">Fetching Aadhar number...</p>
                </div>
                <div class="form-group mb-3">
                    <label for="status" class="form-label">Status</label>
                    <p id="merchantStatus" class="status-text">Merchant Status: Fetching...</p> <!-- Added -->
                    <p id="authStatus" class="status-text">Auth Status: Fetching...</p> <!-- Added -->
                </div>

                <!-- The "Capture Fingerprint" button will be shown only if the status is "Pending" -->
                <div class="form-group mb-3 text-center">
                    <button id="captureFingerprintBtn" class="btn btn-success" style="display:none;" onclick="captureFingerprint()">CAPTURE FINGERPRINT</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-end">
        <div class="col-4">
            <br />
            <input type="button" id="openAepsbutton" style="width:100%;"
                   value="Next" class="btn button mt-2 fs-5 right-elem bg-gradient-primary"
                   onclick="openAepsServices()"
                   disabled title="Authentication required for Registration and Today's Auth" />
        </div>
    </div>
</div>


<nav class="navbar navbar-expand-lg navbar-light bg-light" id="myTab" role="tablist">
    <section>
    <div class="box-header">
        <ul class="nav nav-tabs customtab nav-justified" role="tablist">

                <li class="nav-item">
                    <button class="nav-link active" id="status-tab" data-bs-toggle="tab" data-bs-target="#checkstatus" type="button" role="tab" aria-controls="Refund" aria-selected="false">Withdraw</button>
                </li>
            <li class="nav-item">
                <button class="nav-link " id="recharge-tab" data-bs-toggle="tab" data-bs-target="#recharge" type="button" role="tab" aria-controls="Benificiary" aria-selected="false"> Enquiry</button>
            </li>

           
            <li class="nav-item">
                <button class="nav-link" id="ministatement-tab" data-bs-toggle="tab" data-bs-target="#ministatement" type="button" role="tab" aria-controls="mimistatement" aria-selected="false">MiniStatement</button>
            </li>
@*                 <li class="nav-item">
                    <button class="nav-link" id="transaction-tab" data-bs-toggle="tab" data-bs-target="#transaction" type="button" role="tab" aria-controls="transaction" aria-selected="false">Withdrawl Status</button>
                </li> *@

                <li class="nav-item">
                    <button class="nav-link" id="adhaarpay-tab" data-bs-toggle="tab" data-bs-target="#adhaarpay" type="button" role="tab" aria-controls="adhaarpay" aria-selected="false">Adhaar Pay</button>
                </li>

@*                 <li class="nav-item">
                    <button class="nav-link" id="adhaarpaytransaction-tab" data-bs-toggle="tab" data-bs-target="#adhaarpaytransaction" type="button" role="tab" aria-controls="adhaarpaytransaction" aria-selected="false">Transaction Status</button>
                </li> *@
        </ul> 
    </div>

    </section>
    <div class="tab-content" id="myTabContent">

        <div class="tab-pane fade " id="recharge" role="tabpanel" aria-labelledby="home-tab">

            <section class="content" id="dorechargedv">
                <div class="container-fluid">
                    <div class="col-md-12">

                        <div id="enquerydv">
                            <div class="main-card mb-3 card">
                                <div class="card-body">

                                    <div class="row">

                                        <div class="col-4">
                                            <span style="color:red"></span><label>Mobile Number :</label>
                                            <input type="text" id="enquirymobileno" placeholder="Enter Mobile Number... " required name="mobilenumber"  class="form-control" />

                                        </div>
                                        
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Adhaar Number :</label>
                                            <input type="number" id="enquiryadhaarno" placeholder="Enter Adhaar Number... " required name="adhaarnumber" class="form-control" oninput="validateAadhaarNumber()" />

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Bank :</label>
                                           <select class="form-control" id="enquiryddlbankid">
                                                <option value="0">Select Bank</option>
                                                @foreach (DatumAEPS item in Model.banklist.data)
                                                {
                                                    <option value="@item.iinno">@item.bankName</option>
                                                }
                                            </select>


                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Remarks :</label>
                                            <input type="text" id="enquiryremark" placeholder="Enter requestremarks... " required name="requestremarks" class="form-control" />

                                        </div>
                                        <div class="  col-4">
                                            <br/>
                                            <input type="button" id="enquerybutton" style="width:100%;" value="ENQUERY" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="enquery()" />

                                        </div>
                                </div>




                            </div>

                             
                        </div>

                        
                            <br />



                        </div>
                    </div>


                </div>

            </section>

        </div>
        <div class="tab-pane fade show active" id="checkstatus" role="tabpanel" aria-labelledby="profile-tab">

            <section class="content" id="checkstatusdv">
                <div class="container-fluid">
                    <div class="col-md-12">

                        <div id="withdroldv">
                            <div class="main-card mb-3 card">
                                <div class="card-body">

                                    <div class="row">

                                        <div class="col-4">
                                            <span style="color:red"></span><label>Mobile Number :</label>
                                            <input type="text" id="withdrowlmobileno" placeholder="Enter Mobile Number... " required name="mobilenumber" class="form-control" />

                                        </div>

                                        <div class="col-4">
                                            <span style="color:red"></span><label>Adhaar Number :</label>
                                            <input type="text" id="withdrowladhaarno" placeholder="Enter Adhaar Number... " required name="adhaarnumber" class="form-control" />

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>amount :</label>
                                            <input type="number" id="withdrowlamount" placeholder="Enter amount... " required name="is_iris" class="form-control" />

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Bank :</label>
                                           
                                            <select class="form-control" id="withdrowlddlbankid">
                                                <option>Select Bank</option>
                                                @foreach (DatumAEPS item in Model.banklist.data)
                                                {
                                                    <option value="@item.iinno">@item.bankName</option>
                                                }
                                            </select>

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Remark :</label>
                                            <input type="text" id="withdrowlremark" placeholder="Enter requestremarks... " required name="requestremarks" class="form-control" />

                                        </div>

                                        <div class="col-4">
                                            <br/>
                                            <input type="button" id="withdrowbtn" style="width:100%;" value="WITHDROW" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="withdraw()" />

                                        </div>
                                    </div>




                                </div>

                                 
                            </div>


                            <br />



                        </div>
                    </div>


                </div>
            </section>
        </div>
        <div class="tab-pane fade" id="ministatement" role="tabpanel" aria-labelledby="profile-tab">

            <section class="content" id="ministatementdv">
                <div class="container-fluid">
                     <div class="col-md-12">

                        <div id="statementdv">
                            <div class="main-card mb-3 card">
                                <div class="card-body">

                                    <div class="row">

                                        <div class="col-4">
                                            <span style="color:red"></span><label>Mobile Number :</label>
                                            <input type="text" id="ministatmetnmobileno" placeholder="Enter Mobile Number... " required name="mobilenumber" class="form-control" />

                                        </div>
                                        
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Adhaar Number :</label>
                                            <input type="text" id="ministatmentadhaarno" placeholder="Enter Adhaar Number... " required name="adhaarnumber" class="form-control" />

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Bank :</label>
                                           
                                            <select class="form-control" id="ministatmentddlbackid">
                                                <option>Select Bank</option>
                                                @foreach (DatumAEPS item in Model.banklist.data)
                                                {
                                                    <option value="@item.iinno">@item.bankName</option>
                                                }
                                            </select>

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>requestremarks :</label>
                                            <input type="text" id="ministatmentremark" placeholder="Enter requestremarks... " required name="requestremarks" class="form-control" />

                                        </div>

                                        <div class="col-4">
                                            <br/>
                                            <input type="button" id="ministatmentbtn" style="width:100%;" value="STATEMENT" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="miniStatement()" />

                                        </div>
                                </div>




                            </div>



                            @*<div class=" col-12">
                                    <input type="button" id="ministatmentbtn" style="width:100%;" value="STATEMENT" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="miniStatement()" />

                            </div>*@
                        </div>

                        
                            <br />



                        </div>
                    </div>


                </div>
            </section>
        </div>

        <div class="tab-pane fade" id="transaction" role="tabpanel" aria-labelledby="profile-tab">

            <section class="content" id="transactiondv">
                <div class="container-fluid">
                     <div class="col-md-12">

                        <div id="statementdv">
                            <div class="main-card mb-3 card">
                                <div class="card-body">

                                    <div class="row">

                                    
                                </div>




                            </div>


                             
                        </div>

                        
                            <br />



                        </div>
                    </div>


                </div>
            </section>
        </div>
   
          <div class="tab-pane fade" id="adhaarpay" role="tabpanel" aria-labelledby="adhaarpay-tab">

            <section class="content" id="adhaarpaydv">
                <div class="container-fluid">
                     
                    <div class="col-md-12">

                        <div id="withdroldv">
                            <div class="main-card mb-3 card">
                                <div class="card-body">

                                    <div class="row">

                                        <div class="col-4">
                                            <span style="color:red"></span><label>Mobile Number :</label>
                                            <input type="text" id="adhaarpaymobileno" placeholder="Enter Mobile Number... " required name="mobilenumber" class="form-control" />

                                        </div>

                                        <div class="col-4">
                                            <span style="color:red"></span><label>Adhaar Number :</label>
                                            <input type="text" id="adhaarpayadhaarno" placeholder="Enter Adhaar Number... " required name="adhaarnumber" class="form-control" />

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>amount :</label>
                                            <input type="number" id="adhaarpayamount" placeholder="Enter amount... " required name="is_iris" class="form-control" />

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Bank :</label>

                                            <select class="form-control" id="adhaarpayddlbackid">
                                                <option value="0">Select Bank</option>
                                                @foreach (DatumAEPS item in Model.banklist.data)
                                                {
                                                    <option value="@item.iinno">@item.bankName</option>
                                                }
                                            </select>

                                        </div>
                                        <div class="col-4">
                                            <span style="color:red"></span><label>Remark :</label>
                                            <input type="text" id="adhaarpayremark" placeholder="Enter requestremarks... " required name="requestremarks" class="form-control" />

                                        </div>

                                        <div class="col-4">
                                            <br />
                                            <input type="button" id="adhaarpaybtn" style="width:100%;" value="PAY NOW" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="adhaarPay()" />

                                        </div>
                                    </div>




                                </div>


                            </div>


                            <br />



                        </div>
                    </div>

                </div>
            </section>
        </div>
   
        <div class="tab-pane fade" id="adhaarpaytransaction" role="tabpanel" aria-labelledby="adhaarpay-tab">

            <section class="content" id="adhaarpaytransactiondv">
                <div class="container-fluid">

                    <div class="col-md-12">

                        <div id="withdroldv">
                            <div class="main-card mb-3 card">
                                <div class="card-body">



                                </div>


                            </div>


                            <br />



                        </div>
                    </div>

                </div>
            </section>
        </div>
        
        <div style="display:none;">
                                            <input type="text" id="txtcurrentlocation" placeholder="Location" />
                                            <input type="text" id="lat" placeholder="lat" />
                                            <input type="text" id="lon" placeholder="lon" />
                                        </div>

    </div>
    @*</section>*@




</nav>

<!--Tab End-->

<div id="balanceEnquiryResponse" style="display: none;">
    <h3>Balance Enquiry Result</h3>
    <div class="card">
        <div class="card-body">
            <p><strong>Status:</strong> <span id="status">Fetching...</span></p>
            <p><strong>Message:</strong> <span id="message">Fetching...</span></p>
            <p><strong>Acknowledgement No:</strong> <span id="ackno">Fetching...</span></p>
            <p><strong>Amount:</strong> <span id="amount">Fetching...</span></p>
            <p><strong>Balance Amount:</strong> <span id="balanceamount">Fetching...</span></p>
            <p><strong>Bank RRN:</strong> <span id="bankrrn">Fetching...</span></p>
            <p><strong>Bank IIN:</strong> <span id="bankiin">Fetching...</span></p>
            <p><strong>Response Code:</strong> <span id="response_code">Fetching...</span></p>
            <p><strong>Error Code:</strong> <span id="errorcode">Fetching...</span></p>
            <p><strong>Client Ref No:</strong> <span id="clientrefno">Fetching...</span></p>

            <!-- Save as PDF button -->
            <input type="button" style="width:100%;" value="PRINT SLIP" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="saveAsPDF('balanceEnquiry')" />
            <input type="button" id="backButton" style="width:50%;" value="BACK" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="goBack()" />
        </div>
    </div>
</div>

<div id="miniStatementSection" style="display: none;">
    <h3>Mini Statement Result</h3>
    <div class="card">
        <div class="card-body">
            <p><strong>Status:</strong> <span id="miniStatus">Fetching...</span></p>
            <p><strong>Acknowledgement No:</strong> <span id="miniAckno">Fetching...</span></p>
            <p><strong>Date & Time:</strong> <span id="miniDateTime">Fetching...</span></p>
            <p><strong>Balance Amount:</strong> <span id="miniBalanceAmount">Fetching...</span></p>
            <p><strong>Bank RRN:</strong> <span id="miniBankRRN">Fetching...</span></p>
            <p><strong>Bank IIN:</strong> <span id="miniBankIIN">Fetching...</span></p>
            <p><strong>Message:</strong> <span id="miniMessage">Fetching...</span></p>
            <p><strong>Error Code:</strong> <span id="miniErrorCode">Fetching...</span></p>

            <h4>Transactions</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Txn Type</th>
                        <th>Amount</th>
                        <th>Narration</th>
                    </tr>
                </thead>
                <tbody id="miniStatementTable">
                    <!-- Transactions will be dynamically added here -->
                </tbody>
            </table>
            <input type="button" style="width:100%;" value="PRINT SLIP" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="saveAsPDF('miniStatement')" />
            <input type="button" id="backButton" style="width:50%;" value="BACK" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="goBack()" />
        </div>
    </div>
</div>
<div id="adharPayResponse" style="display: none;">
    <h3>Aadhaar Pay Result</h3>
    <div class="card">
        <div class="card-body">
            <p><strong>Status:</strong> <span id="adharPayStatus">Fetching...</span></p>
            <p><strong>Message:</strong> <span id="adharPayMessage">Fetching...</span></p>
            <p><strong>Acknowledgement No:</strong> <span id="adharPayAckno">Fetching...</span></p>
            <p><strong>Amount:</strong> <span id="adharPayAmount">Fetching...</span></p>
            <p><strong>Balance Amount:</strong> <span id="adharPayBalanceAmount">Fetching...</span></p>
            <p><strong>Bank RRN:</strong> <span id="adharPayBankRRN">Fetching...</span></p>
            <p><strong>Bank IIN:</strong> <span id="adharPayBankIIN">Fetching...</span></p>
            <p><strong>Response Code:</strong> <span id="adharPayResponseCode">Fetching...</span></p>
            <p><strong>Error Code:</strong> <span id="adharPayErrorCode">Fetching...</span></p>

            <!-- Add the Save as PDF button here -->
            <input type="button" id="saveAsAdharPayPdf" style="width:100%;" value="PRINT SLIP" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="saveAsPDF('adharPay')" />
            <input type="button" id="backAdharPayButton" style="width:50%;" value="BACK" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="goBack()" />
        </div>
    </div>
</div>
<div id="withdrawResponse" style="display: none;">
    <h3>Withdraw Result</h3>
    <div class="card">
        <div class="card-body">
            <p><strong>Transaction Status:</strong> <span id="withdrawTxnStatus">Fetching...</span></p>
            <p><strong>Message:</strong> <span id="withdrawMessage">Fetching...</span></p>
            <p><strong>Acknowledgement No:</strong> <span id="withdrawAckno">Fetching...</span></p>
            <p><strong>Amount:</strong> <span id="withdrawAmount">Fetching...</span></p>
            <p><strong>Bank RRN:</strong> <span id="withdrawBankRRN">Fetching...</span></p>
            <p><strong>Response Code:</strong> <span id="withdrawResponseCode">Fetching...</span></p>

            <!-- Add the Save as PDF button here -->
            <input type="button" id="saveAsWithdrawPdfBtn" style="width:100%;" value="PRINT SLIP" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="saveAsPDF('withdraw')" />
            <input type="button" id="backWithdrawButton" style="width:50%;" value="BACK" class="btn button mt-2 fs-5 center-elem bg-gradient-primary" onclick="goBack()" />
        </div>
    </div>
</div>


<script>
        // JavaScript to handle button clicks and display the authentication div
    // Function to toggle the visibility of authDiv
    function toggleAuthDiv() {
        var authDiv = document.getElementById('authDiv');
        var authStatus = document.getElementById('authStatus');
        var marchantStatus = document.getElementById('merchantStatus');

        // Check if the div is currently visible
        if (authDiv.style.display === 'none' || authDiv.style.display === '') {
            authDiv.style.display = 'block';  // Show the div
            authStatus.style.display = 'none';
            marchantStatus.style.display = 'block';
        } else {
            authDiv.style.display = 'none';  // Hide the div
        }
    }

    function toggletodayAuthDiv() {
        var authDiv = document.getElementById('authDiv');
        var authStatus = document.getElementById('authStatus');
        var marchantStatus = document.getElementById('merchantStatus');

        // Check if the div is currently visible
        if (authDiv.style.display === 'none' || authDiv.style.display === '') {
            authDiv.style.display = 'block';  // Show the div
            marchantStatus.style.display = 'none';
            authStatus.style.display = 'block';
        } else {
            authDiv.style.display = 'none';  // Hide the div
        }
    }

    // Add event listeners for both buttons
    document.getElementById('merchantBtn').addEventListener('click', toggleAuthDiv);
    document.getElementById('todayAuthBtn').addEventListener('click', toggletodayAuthDiv);

    function fetchUserData() {
        // Perform AJAX call to fetch 2FA status from your controller
        $("#showSpinner").show();
        $.ajax({
            url: '/AEPS/Get2FAStatus', // URL of your controller action
            method: 'GET',
            success: function (data) {
                debugger;
                console.log(data);
                // Get the button elements
                var merchantBtn = document.getElementById('merchantBtn');
                var todayAuthBtn = document.getElementById('todayAuthBtn');
                var openAepsButton = document.getElementById('openAepsbutton');
                var mobileNumberElem = document.getElementById('mobileNumber');
                var aadharNumberElem = document.getElementById('aadharNumber');
                var merchantStatusElem = document.getElementById('merchantStatus');  // Separate status element for merchant
                var authStatusElem = document.getElementById('authStatus');          // Separate status element for auth
                var captureFingerprintBtn = document.getElementById('captureFingerprintBtn');

                // Check if data is returned correctly
                if (data && !data.error) {
                    // Display mobile and aadhar numbers
                    mobileNumberElem.innerHTML = data.mobileNumber || 'No mobile number found';
                    aadharNumberElem.innerHTML = data.aadharNumber || 'No Aadhar number found';

                    // Update Merchant Registration Status
                    if (data.merchantStatus === 'Success') {
                        merchantBtn.classList.remove('btn-primary');
                        merchantBtn.classList.add('btn-success');
                        merchantBtn.innerHTML = 'Merchant Registration &#10003;'; // Tick sign
                        merchantStatusElem.innerText = 'Success';
                        merchantStatusElem.classList.add('status-success');
                        merchantStatusElem.classList.remove('status-pending');
                    } else {
                        merchantBtn.classList.remove('btn-success');
                        merchantBtn.classList.add('btn-danger');
                        merchantBtn.innerHTML = 'Merchant Registration &#10060;'; // Cross sign
                        merchantStatusElem.innerText = 'Pending';
                        merchantStatusElem.classList.add('status-pending');
                        merchantStatusElem.classList.remove('status-success');
                    }

                    // Update Today's Auth Status
                    if (data.authStatus === 'Success') {
                        todayAuthBtn.classList.remove('btn-secondary');
                        todayAuthBtn.classList.add('btn-success');
                        todayAuthBtn.innerHTML = 'Today\'s Auth &#10003;';
                        authStatusElem.innerText = 'Success';
                        authStatusElem.classList.add('status-success');
                        authStatusElem.classList.remove('status-pending');
                    } else {
                        todayAuthBtn.classList.remove('btn-success');
                        todayAuthBtn.classList.add('btn-danger');
                        todayAuthBtn.innerHTML = 'Today\'s Auth &#10060;';
                        authStatusElem.innerText = 'Pending';
                        authStatusElem.classList.add('status-pending');
                        authStatusElem.classList.remove('status-success');
                    }

                    // Update Capture Fingerprint button based on both statuses
                    if (data.merchantStatus === 'Pending' || data.authStatus === 'Pending') {
                        captureFingerprintBtn.style.display = 'block';
                    } else {
                        captureFingerprintBtn.style.display = 'none';
                    }


                    debugger;
                    // Enable the "Next" button only if both statuses are "Success"
                    if (data.merchantStatus === 'Success' && data.authStatus === 'Success') {
                        openAepsButton.disabled = false;
                        openAepsButton.removeAttribute('title');  // Remove tooltip when button is enabled
                    } else {
                        openAepsButton.disabled = true;
                        openAepsButton.title = 'Authentication is required';  // Add tooltip when button is disabled
                    }
                } else {
                    console.error('Error fetching status:', data.error);
                }
            },
            error: function (err) {
                console.error('AJAX error:', err);
            }
        });
    }
    // Call the function to fetch user data when the page loads
    window.onload = fetchUserData;


    function openAepsServices() {
        // Hide the div with id "2FADiv"
        document.getElementById('2FADiv').style.display = 'none';

        // Show the div with id "myTab"
        document.getElementById('myTab').style.display = 'block';
    }

    function captureFingerprint() {

        var authStatus = document.getElementById('authStatus').innerHTML;
        var marchantStatus = document.getElementById('merchantStatus').innerHTML;

        $.ajax({
            url: '/AEPS/CaptureFingerprintData',  // URL for the backend API
            method: 'POST',
            success: function (response) {
                // Parse the XML response
                var parser = new DOMParser();
                var xmlDoc = parser.parseFromString(response.fingerprintData, "text/xml");

                // Extract the errCode from the XML
                var errCode = xmlDoc.getElementsByTagName("Resp")[0].getAttribute("errCode");
                var errInfo = xmlDoc.getElementsByTagName("Resp")[0].getAttribute("errInfo");

                if (errCode !== "0") {
                    // Error occurred, alert the user and retry fingerprint capture
                    alert("Error reading fingerprint: " + errInfo);

                    // Retry fingerprint capture after some delay (optional)
                    setTimeout(captureFingerprint, 3000); // Retry after 3 seconds
                } else {
                    // Success: You have the fingerprint data
                    var fingerprintData = response.fingerprintData;

                    // Assuming you have Aadhar and Mobile numbers already fetched
                    var aadharNumber = document.getElementById('aadharNumber').innerText.replace(/[^0-9]/g, ''); // Unformatted Aadhar
                    var mobileNumber = document.getElementById('mobileNumber').innerText;

                    //console.log(aadharNumber);
                    //console.log(mobileNumber);
                    //console.log(fingerprintData);

                    // Call registerFingerprint function to send the data
                    if (marchantStatus === 'Pending') {
                        registerFingerprint(aadharNumber, mobileNumber, fingerprintData);
                    }
                    else if(authStatus==='Pending'){
                        dailyAuthentication(aadharNumber, mobileNumber, fingerprintData)
                    }
                }
            },
            error: function (err) {
                console.error("AJAX error:", err);
                alert("Error in capturing fingerprint.");
                // Retry fingerprint capture after some delay (optional)
                setTimeout(captureFingerprint, 3000); // Retry after 3 seconds
            }
        });
    }

    function registerFingerprint(aadharNumber, mobileNumber, fingerprintData) {

        var dataobj = new FormData;

        dataobj.append("mobilenumber", mobileNumber);
        dataobj.append("adhaarnumber", aadharNumber);
        dataobj.append("data", fingerprintData);
        dataobj.append("latitude", '22.44543');
        dataobj.append("longitude", '77.434');
        dataobj.append("accessmodeltype", 'SITE');
        dataobj.append("ipaddress", '');
        dataobj.append("referenceno", '');

        // Prepare XML data to send to the registration API
        var requestData = {
            aadharnumber: aadharNumber,               // Aadhar number fetched from the frontend
            mobilenumber: mobileNumber,               // Mobile number fetched from the frontend
            data: fingerprintData,         // Fingerprint data captured
            latitude: '22.44543',                     // Replace with actual latitude
            longitude: '77.434',                      // Replace with actual longitude
            accessmodetype: 'SITE',                   // Mode of access (from your registration model)
            ipaddress: '',                            // Use IP fetched from backend
            referenceno: '',                          // Generated from the backend
        };
        //console.log(requestData);
        //console.log(dataobj);

        $("#showSpinner").show();
        $.ajax({
            url: '/AEPS/Registration2FA',  // Your 2FA Registration API
            method: 'POST',
            data: dataobj,
            contentType: false,  // Set to application/json
            processData: false,
            success: function (r) {
                r = jQuery.parseJSON(r)
                console.log(r)
                if (r.response_code == '1') {
                    alert(r.message)
                    // Update status or UI based on success
                    fetchUserData();
                }
                else if (r.response_code != 'undefined') {
                    alert(r.message)
                }
                else {
                    alert(r)
                }
                $("#showSpinner").hide();
            },
            error: function (err) {
                console.error("Error during AJAX call:", err);
                alert("Failed to register fingerprint!");
            }
        });
    }

    function dailyAuthentication(aadharNumber, mobileNumber, fingerprintData) {
        var dataobj = new FormData;

        dataobj.append("mobilenumber", mobileNumber);
        dataobj.append("adhaarnumber", aadharNumber);
        dataobj.append("data", fingerprintData);
        dataobj.append("latitude", '22.44543');
        dataobj.append("longitude", '77.434');
        dataobj.append("accessmodeltype", 'SITE');
        dataobj.append("ipaddress", '');
        dataobj.append("referenceno", '');

        // Prepare XML data to send to the registration API
        var requestData = {
            aadharnumber: aadharNumber,               // Aadhar number fetched from the frontend
            mobilenumber: mobileNumber,               // Mobile number fetched from the frontend
            data: fingerprintData,         // Fingerprint data captured
            latitude: '22.44543',                     // Replace with actual latitude
            longitude: '77.434',                      // Replace with actual longitude
            accessmodetype: 'SITE',                   // Mode of access (from your registration model)
            ipaddress: '',                            // Use IP fetched from backend
            referenceno: '',                          // Generated from the backend
        };
        //console.log(requestData);
        //console.log(dataobj);

        $("#showSpinner").show();
        $.ajax({
            url: '/AEPS/DailyAEPSAuth',  // Your daily auth API
            method: 'POST',
            data: dataobj,
            contentType: false, 
            processData: false,
            success: function (r) {
                r = jQuery.parseJSON(r)
                console.log(r)
                if (r.response_code == '1') {
                    alert(r.message)
                    // Update status or UI based on success
                    fetchUserData();
                }
                else if (r.response_code != 'undefined') {
                    alert(r.message)
                }
                else {
                    alert(r)
                }
                $("#showSpinner").hide();
            },
            error: function (err) {
                console.error("Error during AJAX call:", err);
                alert("Failed to register fingerprint!");
            }
        });
    }

    function validateAadhaarNumber() {
        const aadhaarInput = document.getElementById('enquiryadhaarno');
        const errorSpan = document.getElementById('aadhaar-error');
        const aadhaarNumber = aadhaarInput.value;

        // Regular expression to check if Aadhaar is 12 digits long and doesn't start with 0 or 1
        const aadhaarRegex = /^[2-9]{1}[0-9]{11}$/;

        if (!aadhaarRegex.test(aadhaarNumber)) {
            errorSpan.textContent = "Aadhaar number must be 12 digits long and cannot start with 0 or 1.";
            aadhaarInput.setCustomValidity("Invalid Aadhaar Number");
        } else {
            errorSpan.textContent = "";
            aadhaarInput.setCustomValidity("");
        }
    }

    $(document).ready(function () {
        debugger;
        var x = $("#txtcurrentlocation")
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.val("Geolocation is not supported by this browser.");
        }
        function showPosition(position) {
            $("#lat").val(position.coords.latitude)
            $("#lon").val(position.coords.longitude)
        }
         
    })

    function enquery() {
        
        if ($("#lat").val() == "" && $("#lon").val()=="")
        {
            alert('Please On GPS !!');
            return;
        }
        if ($("#enquirymobileno").val() == "") {
            alert('Enter Mobile No !!');
            $("#enquirymobileno").focus()
            return;
        }
        if ($("#enquiryadhaarno").val() == "") {
            alert('Enter Adhaar No !!');
            $("#enquiryadhaarno").focus()
            return;
        }
        if ($("#enquiryddlbankid").val() == "0") {
            alert('Please Select Bank !!');
            $("#enquiryddlbankid").focus()
            return;
        }
        if ($("#enquiryremark").val() == "") {
            alert('Please Enter Remark!!');
            $("#enquiryremark").focus()
            return;
        }
        var dataobj = new FormData;

        dataobj.append("latitude", $("#lat").val());
        dataobj.append("longitude", $("#lon").val());
        dataobj.append("mobilenumber", $("#enquirymobileno").val());
        dataobj.append("adhaarnumber", $("#enquiryadhaarno").val());
        dataobj.append("nationalbankidentification", $("#enquiryddlbankid").val());
        dataobj.append("requestremarks", $("#enquiryremark").val());
        //dataobj.append("data", $("#txtrefid").val()); 
        dataobj.append("is_iris", 'No');

        $("#showSpinner").show();
        $.ajax({
            url: "/AEPS/Enquiry",
            type: "POST",
            contentType: false,
            processData: false,
            data: dataobj,
            success: function (r) {
                r=jQuery.parseJSON(r)
    console.log(r)
    if(r.response_code=='1')
    {
                    alert(r.message)
                    bindEnquiryDataToUI(r);
                    $("#myTab").hide();  // Hide the navigation tab
                    $("#balanceEnquiryResponse").show();
                }
    else if (r.response_code!='undefined')
    {
                    alert(r.message)
    }
    else
    {
        alert(r)
    }
                $("#showSpinner").hide();
            },
            error: function () {
                alert("Error Occured !!!")
                $("#showSpinner").hide();
            }
        })
    }

    function bindEnquiryDataToUI(data) {
        if (!data) {
            alert("Invalid response data");
            return;
        }

        $("#status").text(data.status ? "Success" : "Failed");
        $("#message").text(data.message || "No message available");
        $("#ackno").text(data.ackno || "N/A");
        $("#amount").text(data.amount || "N/A");
        $("#balanceamount").text(data.balanceamount || "N/A");
        $("#bankrrn").text(data.bankrrn || "N/A");
        $("#bankiin").text(data.bankiin || "N/A");
        $("#response_code").text(data.response_code || "N/A");
        $("#errorcode").text(data.errorcode || "N/A");
        $("#clientrefno").text(data.clientrefno || "N/A");
    }

    function saveAsPDF(section) {
        let formData = new FormData();

        // Append the relevant data to FormData based on the section
        if (section === 'balanceEnquiry') {
            formData.append("Name", document.getElementById("clientrefno").innerText);
            formData.append("Status", document.getElementById("status").innerText);
            formData.append("Message", document.getElementById("message").innerText);
            formData.append("AcknowledgementNo", document.getElementById("ackno").innerText);
            formData.append("Amount", document.getElementById("amount").innerText);
            formData.append("BalanceAmount", document.getElementById("balanceamount").innerText);
            formData.append("BankRRN", document.getElementById("bankrrn").innerText);
            formData.append("BankIIN", document.getElementById("bankiin").innerText);
            formData.append("ResponseCode", document.getElementById("response_code").innerText);
            formData.append("ErrorCode", document.getElementById("errorcode").innerText);
            formData.append("ClientRefNo", document.getElementById("clientrefno").innerText); // Assuming it's same as Name
        } else if (section === 'miniStatement') {
            formData.append("Name", document.getElementById("miniAckno").innerText);
            formData.append("Status", document.getElementById("miniStatus").innerText);
            formData.append("Message", document.getElementById("miniMessage").innerText);
            formData.append("AcknowledgementNo", document.getElementById("miniAckno").innerText);
            formData.append("BalanceAmount", document.getElementById("miniBalanceAmount").innerText);
            formData.append("BankRRN", document.getElementById("miniBankRRN").innerText);
            formData.append("BankIIN", document.getElementById("miniBankIIN").innerText);
            formData.append("ResponseCode", ""); // Assume this is not needed for Mini Statement
            formData.append("ErrorCode", document.getElementById("miniErrorCode").innerText);
            formData.append("ClientRefNo", ""); // Assume this is not needed for Mini Statement
            formData.append("DateTime", document.getElementById("miniDateTime").innerText);
            formData.append("MiniBalanceAmount", document.getElementById("miniBalanceAmount").innerText);
            formData.append("MiniErrorCode", document.getElementById("miniErrorCode").innerText);
        }
         else if (section === 'withdraw') {
            formData.append("TransactionStatus", $("#withdrawTxnStatus").text());
            formData.append("Message", $("#withdrawMessage").text());
            formData.append("AcknowledgementNo", $("#withdrawAckno").text());
            formData.append("Amount", $("#withdrawAmount").text());
            formData.append("BankRRN", $("#withdrawBankRRN").text());
            formData.append("ResponseCode", $("#withdrawResponseCode").text());
        }
        $("#showSpinner").show();
        // Call the C# method via AJAX
        $.ajax({
            url: '/AEPS/GeneratePDF', // Update to your actual controller route
            type: 'POST',
            contentType: false,
            processData: false,
            data: formData,
            xhr: function () {
                var xhr = new window.XMLHttpRequest();
                // Set up a function to run when the request is complete
                xhr.onload = function () {
                    if (xhr.status === 200) {
                        // Create a blob from the PDF response
                        var blob = new Blob([xhr.response], { type: 'application/pdf' });
                        var link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = 'GeneratedReport.pdf';
                        link.click();
                    } else {
                        alert("An error occurred while generating the PDF. Please try again.");
                    }
                };
                // Set the response type to 'blob'
                xhr.responseType = 'blob';
                return xhr;
            },
            error: function (xhr, status, error) {
                console.error("Error generating PDF:", error);
                alert("An error occurred while generating the PDF. Please try again.");
            }
        });
    }

    function withdraw() {
        
        if ($("#lat").val() == "" && $("#lon").val() == "") {
            alert('Please On GPS !!');
            return;
        }
        if ($("#withdrowlmobileno").val() == "") {
            alert('Enter Mobile No !!');
            $("#withdrowlmobileno").focus()
            return;
        }
        if ($("#withdrowladhaarno").val() == "") {
            alert('Enter Adhaar No !!');
            $("#withdrowladhaarno").focus()
            return;
        }
        if ($("#withdrowlamount").val() == "") {
            alert('Please Enter Amount !!');
            $("#withdrowlamount").focus()
            return;
        }
        if ($("#withdrowlddlbankid").val() == "0") {
            alert('Please Select Bank!!');
            $("#withdrowlddlbankid").focus()
            return;
        }
        if ($("#withdrowlremark").val() == "") {
            alert('Please Enter Remark!!');
            $("#withdrowlremark").focus()
            return;
        }
        var dataobj = new FormData;

        dataobj.append("latitude", $("#lat").val());
        dataobj.append("longitude", $("#lon").val());
        dataobj.append("mobilenumber", $("#withdrowlmobileno").val());
        dataobj.append("adhaarnumber", $("#withdrowladhaarno").val());
        dataobj.append("nationalbankidentification", $("#withdrowlddlbankid").val());
        dataobj.append("requestremarks", $("#withdrowlremark").val());
        dataobj.append("amount", $("#withdrowlamount").val());
        //dataobj.append("data", $("#txtrefid").val());
        dataobj.append("is_iris", 'No');

        $("#showSpinner").show();
        $.ajax({
            url: "/AEPS/Withdraw",
            type: "POST",
            contentType: false,
            processData: false,
            data: dataobj,
            success: function (r) {
               r=jQuery.parseJSON(r)
    console.log(r)
    if(r.response_code=='1')
    {
                    alert(r.message)
                    $("#withdrawResponse").show(); // Show the response section
                    $("#withdrawTxnStatus").text(r.txnstatus);
                    $("#withdrawMessage").text(r.message);
                    $("#withdrawAckno").text(r.ackno);
                    $("#withdrawAmount").text(r.amount);
                    $("#withdrawBankRRN").text(r.bankrrn);
                    $("#withdrawResponseCode").text(r.response_code);

                    $("#myTab").hide();  // Hide the navigation tab
                    $("#withdrawResponse").show();
    }
    else if (r.response_code!='undefined')
    {
                    alert(r.message)
    }
    else
    {
        alert(r)
    }
                $("#showSpinner").hide();
            },
            error: function () {
                alert("Error Occured !!!")
                $("#showSpinner").hide();
            }
        })
    }
    function miniStatement() {

        if ($("#lat").val() == "" && $("#lon").val() == "") {
            alert('Please On GPS !!');
            return;
        }
        if ($("#ministatmetnmobileno").val() == "") {
            alert('Enter Mobile No !!');
            $("#ministatmetnmobileno").focus()
            return;
        }
        if ($("#ministatmentadhaarno").val() == "") {
            alert('Enter Adhaar No !!');
            $("#ministatmentadhaarno").focus()
            return;
        }
        if ($("#ministatmentddlbackid").val() == "0") {
            alert('Please Select Bank !!');
            $("#ministatmentddlbackid").focus()
            return;
        }
        if ($("#ministatmentremark").val() == "") {
            alert('Please Enter Remark!!');
            $("#ministatmentremark").focus()
            return;
        }
        var dataobj = new FormData;

        dataobj.append("latitude", $("#lat").val());
        dataobj.append("longitude", $("#lon").val());
        dataobj.append("mobilenumber", $("#ministatmetnmobileno").val());
        dataobj.append("adhaarnumber", $("#ministatmentadhaarno").val());
        dataobj.append("nationalbankidentification", $("#ministatmentddlbackid").val());
        dataobj.append("requestremarks", $("#ministatmentremark").val());
        dataobj.append("is_iris", 'No');

        $("#showSpinner").show();
        $.ajax({
            url: "/AEPS/MiniStatement",
            type: "POST",
            contentType: false,
            processData: false,
            data: dataobj,
            success: function (r) {
             r=jQuery.parseJSON(r)
             console.log(r)
                if(r.response_code=='1')
                {
                                alert(r.message)
                    bindMiniStatementData(r); // Call function to bind data to UI
                }
                else if (r.response_code!='undefined')
                {
                                alert(r.message)
                }
                else
                {
                    alert(r)
                }
                $("#showSpinner").hide();
            },
            error: function () {
                alert("Error Occured !!!")
                $("#showSpinner").hide();
            }
        })
    }
    function bindMiniStatementData(data) {
        // Show the mini statement section
        $("#miniStatementSection").show();

        // Bind data to the mini statement result fields
        $("#miniStatus").text(data.status ? "Success" : "Failed");
        $("#miniAckno").text(data.ackno);
        $("#miniDateTime").text(data.datetime);
        $("#miniBalanceAmount").text(data.balanceamount);
        $("#miniBankRRN").text(data.bankrrn);
        $("#miniBankIIN").text(data.bankiin);
        $("#miniMessage").text(data.message);
        $("#miniErrorCode").text(data.errorcode);

        // Clear the previous mini-statement transactions
        $("#miniStatementTable").empty();

        // Loop through the mini-statement array and add each transaction to the table
        if (data.ministatement && data.ministatement.length > 0) {
            data.ministatement.forEach(function (txn) {
                var row = "<tr>" +
                    "<td>" + txn.date + "</td>" +
                    "<td>" + txn.txnType + "</td>" +
                    "<td>" + txn.amount + "</td>" +
                    "<td>" + txn.narration + "</td>" +
                    "</tr>";
                $("#miniStatementTable").append(row);
            });
        } else {
            // If no transactions found, show a message in the table
            var row = "<tr><td colspan='4' class='text-center'>No transactions found</td></tr>";
            $("#miniStatementTable").append(row);
        }

        // Hide the myTab div
        $("#myTab").hide();
    }

    function adhaarPay() {

        if ($("#lat").val() == "" && $("#lon").val() == "") {
            alert('Please On GPS !!');
            return;
        }
        if ($("#adhaarpaymobileno").val() == "") {
            alert('Enter Mobile No !!');
            $("#adhaarpaymobileno").focus()
            return;
        }
        if ($("#adhaarpayadhaarno").val() == "") {
            alert('Enter Adhaar No !!');
            $("#adhaarpayadhaarno").focus()
            return;
        }
        if ($("#adhaarpayamount").val() == "") {
            alert('Enter Amount !!');
            $("#adhaarpayamount").focus()
            return;
        }
        if ($("#adhaarpayddlbackid").val() == "0") {
            alert('Please Select Bank !!');
            $("#adhaarpayddlbackid").focus()
            return;
        }
        if ($("#adhaarpayremark").val() == "") {
            alert('Please Enter Remark!!');
            $("#adhaarpayremark").focus()
            return;
        }
        var dataobj = new FormData;

        dataobj.append("latitude", $("#lat").val());
        dataobj.append("longitude", $("#lon").val());
        dataobj.append("mobilenumber", $("#adhaarpaymobileno").val());
        dataobj.append("adhaarnumber", $("#adhaarpayadhaarno").val());
        dataobj.append("nationalbankidentification", $("#adhaarpayddlbackid").val());
        dataobj.append("requestremarks", $("#adhaarpayremark").val());
        dataobj.append("amount", $("#adhaarpayamount").val());
        //dataobj.append("data", $("#txtrefid").val());
        dataobj.append("is_iris", 'false');

        $("#showSpinner").show();
        $.ajax({
            url: "/AEPS/AdharPay",
            type: "POST",
            contentType: false,
            processData: false,
            data: dataobj,
            success: function (r) {
                r = jQuery.parseJSON(r)
                console.log(r)
                if (r.response_code == '1') {
                    alert(r.message)
                    // Populate the new section with the response data
                    $("#adharPayResponse").show(); // Show the response section
                    $("#adharPayStatus").text("Success");
                    $("#adharPayMessage").text(r.message);
                    $("#adharPayAckno").text(r.ackno);
                    $("#adharPayAmount").text(r.amount);
                    $("#adharPayBalanceAmount").text(r.balanceamount);
                    $("#adharPayBankRRN").text(r.bankrrn);
                    $("#adharPayBankIIN").text(r.bankiin);
                    $("#adharPayResponseCode").text(r.response_code);
                    $("#adharPayErrorCode").text(r.errorcode || "N/A");

                    $("#myTab").hide();  // Hide the navigation tab
                    $("#adharPayResponse").show();
                }
                else if (r.response_code != 'undefined') {
                    alert(r.message)
                }
                else {
                    alert(r)
                }
                $("#showSpinner").hide();
            },
            error: function () {
                alert("Error Occured !!!")
                $("#showSpinner").hide();
            }
        })
    }
    $(document).ready(function () {
        $('select').select2();
    });

    function goBack() {
        window.location.href = "https://app.grofinhub.com/Admin/AEPS";  // Redirect to the desired URL
    }

</script>